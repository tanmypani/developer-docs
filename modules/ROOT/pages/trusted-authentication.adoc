= Trusted authentication
:toc: true
:toclevels: 1

:page-title: trusted authentication
:page-pageid: trusted-auth
:page-description: You can configure support for token-based authentication service on ThoughtSpot.

Trusted authentication allows a web application to authenticate a user to a ThoughtSpot instance using *login tokens* requested from a ThoughtSpot instance. 

It is the most seamless method of single sign-on (SSO) available to embed ThoughtSpot, but the actual *authentication* of the user is performed only by the *web application*, which then securely passes the user details to a *token request service* that must be developed and added to the web application.

image::./images/trusted-auth-workflow.png[Trusted Authentication Workflow]

== Quick start
The Trusted authentication implementation method includes the following steps:

. xref:trusted-authentication.adoc#_get_a_secret_key_for_trusted_authentication[Enable Trusted authentication on ThoughtSpot] in the **Develop** > **Customizations** > **Security Settings** page. Copy the `secret_key` and place where the *token request service* can xref:trusted-auth-secret-key.adoc[securely access it].
. Create the *xref:rusted-auth-token-request-service.adoc[token request service]*, typically a REST API endpoint in the embedding application. This service returns the login token for the user signed-in by the web application. 
. Include the xref:trusted-auth-sdk.adoc[Visual Embed SDK] into the embedding web application. The authentication type is defined in the `init` function. You can configure cookie-based (`AuthType.TrustedAuthToken`) or cookieless authentication (`AuthType.TrustedAuthTokenCookieless`) as per your deployment needs. 
+
. When `init()` is called, the SDK checks if there is an existing ThoughtSpot session for the instance in the browser. If not, it will request a *login token* from either the `authEndpoint` URL specified in the SDK or the `getAuthToken` callback function.  For `authEndPoint`, specify the authentication endpoint URL from which you want to obtain the authentication token. If using `getAuthToken`, call the `getAuthToken` function to invoke your login endpoint. The login endpoint then returns a `Promise` string that resolves to an authentication token.

If you are embedding ThoughtSpot content in an app that is not in the same domain as your ThoughtSpot instance, and your web browser blocks third-party cookies, use cookieless authentication.

== Cookie-based vs. cookieless authentication
The trusted authentication method supports cookie-based and cookieless authentication. 

In cookie-based authentication, the login token is only necessary during the login process, after which any request to ThoughtSpot will include session cookies that identify the signed-in user.

In cookieless authentication, the bearer token issued by the authentication server is used to authenticate API requests to ThoughtSpot.






[#login-token]

== Troubleshoot trusted authentication
Please see the xref:trusted-auth-troubleshoot.adoc[troubleshooting steps] if you encounter issues with the browse-side aspects of the trusted authentication implementation.


== Implement without Visual Embed SDK
The Visual Embed SDK handles the final REST API request to create the session, but it is possible to perform the login using xref:session-api.adoc#session-loginToken[/session/login/token] or the xref:rest-api-v2-reference.adoc#_authentication[ REST API v2.0 token access endpoints]. For more information, see xref:api-auth-session.adoc#_authenticate_and_log_in_with_a_token_trusted_authentication[REST API v1 authentication] and xref:authentication.adoc#trusted-auth-v2[REST API v2.0 authentication].

[NOTE]
====
The REST API v1 `session/login/token` and v2.0 token access endpoints are not used for establishing a REST API session for backend processes or administration scripts. Use the xref:session-api.adoc#session-login[/session/login] endpoint with `username` and `password` to create a REST API session.

////
* The REST API v2.0 allows using bearer or trusted authentication tokens. The authentication tokens obtained from REST API separate from the REST API v1 login token.
////
====

////
REST API clients can make a `GET` or `POST` API call to the xref:session-api.adoc#session-loginToken[tspublic/v1/session/login/token] API endpoint to log in a user. Note that the `GET` call to the `tspublic/v1/session/login/token` endpoint must include a fully-encoded URL with the authentication token and resource endpoint in the request URL.

----
https://{ThoughtSpot-Host}/callosum/v1/tspublic/v1/session/login/token?username=tsUser&auth_token=JHNoaXJvMSRTSEEtMjU2JDUwMDAwMCRPMFA2S0ZlNm51Qlo4NFBlZUppdzZ3PT0kMnJKaSswSHN6Yy96ZGxqdXUwd1dXZkovNVlHUW40d3FLMVdBT3hYVVgxaz0&redirect_url=https://<redirect-domain>/?authtoken=<auth_token>&embedApp=true&primaryNavHidden=true#/embed/viz/<Liveboard_id>/<visualization_id>
----

ThoughtSpot recommends sending the authentication attributes in a `POST` request body instead of a `GET` call.

----
curl -X POST \
--header 'Content-Type: application/x-www-form-urlencoded' \
--header 'Accept: application/json' \
-d 'username=tsuser&auth_token=JHNoaXJvMSRTSEEtMjU2JDUwMDAwMCRtL3dWcVo2ZTdWTzYvemdXN1ZoaTh3PT0kdmlyNnQ4NHlwYXlqNFV4VzBpRlNYbmQ1bzk5T1RFK2NVZy9ZRUhvUEkvST0&redirect_url=https://<ThoughtSpot-Host>/?embedV2=true#/pinboard/7a9a6715-e154-431b-baaf-7b58246c13dd%2F' \
'https://<ThoughtSpot-Host>/callosum/v1/tspublic/v1/session/login/token'
----

The API request must include the following attributes:

* `username` +
_String_. The `username` of the user requesting access to the embedded ThoughtSpot content.

* `auth_token` +
_String_. The authentication token obtained for the user.

* `redirect_url` +
_String_. The URL to which the user is redirected after successful authentication.

+
----
https://<redirect-domain>/?embedV2=true#/pinboard/7a9a6715-e154-431b-baaf-7b58246c13dd%2F
----
////

== Additional resources


* link:https://github.com/thoughtspot/big-react-demo[React code samples, window=_blank]
